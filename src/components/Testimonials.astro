---
import { getCollection } from "astro:content";
const testimonials = await getCollection("testimonials");

const TESTIMONIALS_AMOUNT = 3;

const getRandomElements = <T extends {}>({
  source,
  amount,
}: {
  source: T[];
  amount: number;
}) => {
  const arrayCopy = [...source];
  const result = new Array<T>();

  for (let i = 0; i < amount; i++) {
    if (arrayCopy.length == 0) {
      return result;
    }
    // Remove one random element from arrayCopy and add it to result
    result.unshift(
      arrayCopy.splice(Math.floor(Math.random() * arrayCopy.length), 1)[0]
    );
  }

  return result;
};

const chosenTestimonials = getRandomElements({
        source: testimonials[0].data.testimonials,
        amount: TESTIMONIALS_AMOUNT,
      })
---
<ul>
    {chosenTestimonials.map((testimonial) => (
      <li>{testimonial.message}</li>
    ))}
  </ul>
  <p>
    <button
      onClick={() =>
        setChosenTestimonials(
          getRandomElements({
            source: props.testimonials,
            amount: TESTIMONIALS_AMOUNT,
          })
        )
      }
    >
      Give me more testimonials!
    </button>
  </p>
  <div>
    Want to submit your own? Head to the{" "}
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSeii5nDElD8vt9aL5AIOCxtMB-CDHHMC-081QgU0ZiK-HseBQ/viewform">
      &quot;Ms Boba fishes for compliments&quot; survey
    </a>
    .
  </div>